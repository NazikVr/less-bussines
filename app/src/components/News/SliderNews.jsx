// Import Swiper React components
import { Swiper, SwiperSlide } from "swiper/react";

// Import Swiper styles
import "swiper/css";
import "swiper/css/scrollbar";
import "swiper/css/navigation";

// import required modules
import { Keyboard, Scrollbar, Navigation, Autoplay } from "swiper"

import Container from 'react-bootstrap/Container';
import Row from 'react-bootstrap/Row';
import Col from 'react-bootstrap/Col';

import * as dayjs from 'dayjs';
import { useEffect, useState } from "react";
import { Link } from 'react-router-dom';
import NewsItem from "./NewsItem";
import { getNewsList } from "../../Axios/getNews";
import { getLastImg, setDeafaultImg } from "../../utils/news";
import Loader from "../Loader";

function SliderNews () {

  const [loading, SetLoading] = useState(true);
  const [newsList, SetNewsList] = useState([]);
  const [totalNews, SetTotalNews] = useState(0);

  useEffect(()=>{
    let active = false;
    getNewsList(SetLoading, 1).then((response)=>{
      const data = response['hydra:member'];
      const total = response['hydra:totalItems'];
      
      const newData = data.map((item)=>{
          return { 
            id : item.id,
            idImg: item.id.toString().slice(-1),
            title: item.name,  
            time: dayjs(item.date).format('DD.MM.YYYY'), 
            imglink: item.imgLink || getLastImg(item.newsFull), 
          };
      })
      if (!active) {
        SetNewsList(newData);
        SetTotalNews(total);
      }
    })
    return () => {
      active = true;
    };

  },[])
  
  return (
    <Container className="slider-news">
    <Row>
       <Col className = "item-news">
          <div className="line"></div>
            <h2>Наші новини <span><Link to="/news">Всі новини {totalNews} </Link>
              <svg className ='news-all-arrow' width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.8619 13.138C8.73692 13.013 8.66671 12.8434 8.66671 12.6667C8.66671 12.4899 8.73692 12.3203 8.8619 12.1953L13.7239 7.33333L0.666667 7.33333C0.489855 7.33333 0.320286 7.2631 0.195262 7.13807C0.0702378 7.01305 5.98276e-07 6.84348 5.82819e-07 6.66667C5.67361e-07 6.48986 0.0702377 6.32029 0.195262 6.19527C0.320286 6.07024 0.489855 6 0.666667 6L13.7239 6L8.8619 1.13808C8.73688 1.01304 8.66664 0.843467 8.66665 0.666652C8.66666 0.489838 8.73691 0.320268 8.86194 0.195246C8.98697 0.0702248 9.15655 -7.05696e-06 9.33336 5.83442e-07C9.51018 8.22384e-06 9.67975 0.0702549 9.80477 0.195287L15.8048 6.19527C15.8069 6.19743 15.8087 6.19983 15.8109 6.20203C15.824 6.21554 15.8368 6.22941 15.8488 6.24398C15.8555 6.25212 15.8613 6.26074 15.8676 6.26913C15.8743 6.27816 15.8813 6.28703 15.8877 6.29643C15.8941 6.30611 15.8998 6.3162 15.9057 6.32617C15.9109 6.33488 15.9164 6.34339 15.9212 6.35238C15.9266 6.36239 15.9311 6.37272 15.9359 6.38294C15.9404 6.39246 15.9452 6.40182 15.9492 6.41154C15.9533 6.42139 15.9566 6.43148 15.9602 6.44149C15.964 6.45199 15.968 6.46241 15.9712 6.47315C15.9742 6.48311 15.9765 6.49325 15.979 6.50334C15.9818 6.51432 15.9849 6.52523 15.9871 6.53642C15.9894 6.54806 15.9908 6.55978 15.9924 6.57146C15.9938 6.5813 15.9957 6.59095 15.9967 6.60087C15.9988 6.62276 16 6.6447 16 6.66667C16 6.68864 15.9988 6.71057 15.9967 6.73246C15.9957 6.74239 15.9938 6.75204 15.9924 6.76188C15.9908 6.77356 15.9894 6.78528 15.9871 6.79691C15.9849 6.8081 15.9818 6.81901 15.979 6.83C15.9765 6.84009 15.9742 6.85022 15.9712 6.86019C15.968 6.87093 15.964 6.88135 15.9602 6.89185C15.9566 6.90186 15.9533 6.91195 15.9492 6.92179C15.9452 6.93152 15.9404 6.94088 15.9359 6.9504C15.9311 6.96061 15.9266 6.97095 15.9212 6.98096C15.9164 6.98995 15.9109 6.99846 15.9057 7.00716C15.8998 7.01713 15.8941 7.02722 15.8877 7.03691C15.8814 7.04631 15.8743 7.05518 15.8676 7.06421C15.8613 7.07259 15.8555 7.08122 15.8488 7.08936C15.8366 7.10421 15.8236 7.11833 15.8102 7.13208C15.8083 7.134 15.8067 7.13615 15.8048 7.13806L9.80477 13.138C9.74286 13.2 9.66936 13.2491 9.58847 13.2826C9.50759 13.3161 9.42089 13.3333 9.33333 13.3333C9.24578 13.3333 9.15908 13.3161 9.07819 13.2826C8.9973 13.2491 8.92381 13.2 8.8619 13.138Z" fill="#858A8F"/>
              </svg>
            </span></h2>
      </Col>
    </Row>
    {
      loading ? <Loader/> 
      : 
      <>
        <Swiper
        slidesPerView={3}
        spaceBetween={30}
        centeredSlides={false}
        grabCursor={true}
        loop={true}
        autoplay= {false}
        keyboard={{
          enabled: true,
        }}
        breakpoints={{
          990: {
            slidesPerView: 3,
          },
          545: {
            slidesPerView: 2,
          },
          200: {
            slidesPerView: 1,
          }
        }}
        scrollbar={true}
        navigation={{
          nextEl: ".image-swiper-button-next",
          prevEl: ".image-swiper-button-prev",
        }}
        modules={[Keyboard, Scrollbar, Navigation, Autoplay]}
      >
        {newsList.map((newsItem)=>{
          return (
            <SwiperSlide key={newsItem.id}>
              <NewsItem
                id={newsItem.id} 
                path={newsItem?.imglink || setDeafaultImg(newsItem.idImg).path}
                time={newsItem.time} 
                title = {newsItem.title}/>
            </SwiperSlide>  
          )
        })}
        </Swiper>
        <div className="arrow-container">
            <div className="image-swiper-button-prev">
               <svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.2928 0.292884C13.1054 0.480449 13.0001 0.734786 13.0001 0.999976C13.0001 1.26517 13.1054 1.5195 13.2928 1.70707L20.5858 8.99998L1 8.99998C0.734784 8.99998 0.48043 9.10533 0.292893 9.29287C0.105357 9.4804 8.97435e-07 9.73476 8.74249e-07 9.99998C8.51062e-07 10.2652 0.105357 10.5195 0.292893 10.7071C0.480429 10.8946 0.734784 11 1 11L20.5858 11L13.2928 18.2929C13.1053 18.4804 13 18.7348 13 19C13 19.2652 13.1054 19.5196 13.2929 19.7071C13.4805 19.8947 13.7348 20 14 20C14.2653 20 14.5196 19.8946 14.7072 19.7071L23.7072 10.7071C23.7104 10.7038 23.7131 10.7002 23.7163 10.6969C23.7361 10.6767 23.7552 10.6559 23.7732 10.634C23.7832 10.6218 23.792 10.6089 23.8014 10.5963C23.8115 10.5827 23.822 10.5694 23.8315 10.5553C23.8412 10.5408 23.8497 10.5257 23.8586 10.5107C23.8664 10.4977 23.8746 10.4849 23.8818 10.4714C23.8898 10.4564 23.8967 10.4409 23.9039 10.4256C23.9107 10.4113 23.9178 10.3973 23.9238 10.3827C23.9299 10.3679 23.9349 10.3528 23.9403 10.3377C23.9459 10.322 23.952 10.3064 23.9569 10.2903C23.9614 10.2753 23.9647 10.2601 23.9685 10.245C23.9727 10.2285 23.9773 10.2121 23.9806 10.1953C23.9841 10.1779 23.9861 10.1603 23.9887 10.1428C23.9908 10.128 23.9936 10.1136 23.995 10.0987C23.9983 10.0658 24 10.0329 24 9.99998C24 9.96702 23.9983 9.93412 23.995 9.90128C23.9936 9.88639 23.9908 9.87193 23.9887 9.85716C23.9862 9.83964 23.9841 9.82206 23.9806 9.80461C23.9773 9.78782 23.9727 9.77147 23.9685 9.75498C23.9647 9.73985 23.9614 9.72465 23.9569 9.70969C23.952 9.69358 23.9459 9.67796 23.9403 9.66221C23.9349 9.64719 23.9299 9.63206 23.9238 9.61729C23.9178 9.6027 23.9106 9.58866 23.9039 9.57438C23.8967 9.55906 23.8898 9.54356 23.8818 9.52854C23.8746 9.51505 23.8664 9.50229 23.8586 9.48923C23.8497 9.47428 23.8412 9.45914 23.8315 9.44462C23.822 9.43052 23.8115 9.41721 23.8014 9.40366C23.792 9.39109 23.7832 9.37815 23.7732 9.36594C23.7549 9.34367 23.7354 9.32249 23.7153 9.30186C23.7124 9.29898 23.7101 9.29575 23.7072 9.29288L14.7072 0.292884C14.6143 0.200017 14.504 0.12635 14.3827 0.076089C14.2614 0.0258285 14.1313 -3.90097e-05 14 -3.90212e-05C13.8687 -3.90327e-05 13.7386 0.0258284 13.6173 0.076089C13.496 0.126349 13.3857 0.200017 13.2928 0.292884Z" fill="#858A8F"/>
              </svg>
            </div>
            <div className="image-swiper-button-next">
              <svg width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.2928 0.292884C13.1054 0.480449 13.0001 0.734786 13.0001 0.999976C13.0001 1.26517 13.1054 1.5195 13.2928 1.70707L20.5858 8.99998L1 8.99998C0.734784 8.99998 0.48043 9.10533 0.292893 9.29287C0.105357 9.4804 8.97435e-07 9.73476 8.74249e-07 9.99998C8.51062e-07 10.2652 0.105357 10.5195 0.292893 10.7071C0.480429 10.8946 0.734784 11 1 11L20.5858 11L13.2928 18.2929C13.1053 18.4804 13 18.7348 13 19C13 19.2652 13.1054 19.5196 13.2929 19.7071C13.4805 19.8947 13.7348 20 14 20C14.2653 20 14.5196 19.8946 14.7072 19.7071L23.7072 10.7071C23.7104 10.7038 23.7131 10.7002 23.7163 10.6969C23.7361 10.6767 23.7552 10.6559 23.7732 10.634C23.7832 10.6218 23.792 10.6089 23.8014 10.5963C23.8115 10.5827 23.822 10.5694 23.8315 10.5553C23.8412 10.5408 23.8497 10.5257 23.8586 10.5107C23.8664 10.4977 23.8746 10.4849 23.8818 10.4714C23.8898 10.4564 23.8967 10.4409 23.9039 10.4256C23.9107 10.4113 23.9178 10.3973 23.9238 10.3827C23.9299 10.3679 23.9349 10.3528 23.9403 10.3377C23.9459 10.322 23.952 10.3064 23.9569 10.2903C23.9614 10.2753 23.9647 10.2601 23.9685 10.245C23.9727 10.2285 23.9773 10.2121 23.9806 10.1953C23.9841 10.1779 23.9861 10.1603 23.9887 10.1428C23.9908 10.128 23.9936 10.1136 23.995 10.0987C23.9983 10.0658 24 10.0329 24 9.99998C24 9.96702 23.9983 9.93412 23.995 9.90128C23.9936 9.88639 23.9908 9.87193 23.9887 9.85716C23.9862 9.83964 23.9841 9.82206 23.9806 9.80461C23.9773 9.78782 23.9727 9.77147 23.9685 9.75498C23.9647 9.73985 23.9614 9.72465 23.9569 9.70969C23.952 9.69358 23.9459 9.67796 23.9403 9.66221C23.9349 9.64719 23.9299 9.63206 23.9238 9.61729C23.9178 9.6027 23.9106 9.58866 23.9039 9.57438C23.8967 9.55906 23.8898 9.54356 23.8818 9.52854C23.8746 9.51505 23.8664 9.50229 23.8586 9.48923C23.8497 9.47428 23.8412 9.45914 23.8315 9.44462C23.822 9.43052 23.8115 9.41721 23.8014 9.40366C23.792 9.39109 23.7832 9.37815 23.7732 9.36594C23.7549 9.34367 23.7354 9.32249 23.7153 9.30186C23.7124 9.29898 23.7101 9.29575 23.7072 9.29288L14.7072 0.292884C14.6143 0.200017 14.504 0.12635 14.3827 0.076089C14.2614 0.0258285 14.1313 -3.90097e-05 14 -3.90212e-05C13.8687 -3.90327e-05 13.7386 0.0258284 13.6173 0.076089C13.496 0.126349 13.3857 0.200017 13.2928 0.292884Z" fill="#858A8F"/>
              </svg>
            </div>
        </div>
      </>
    }
  </Container>
  );
}

export default SliderNews


